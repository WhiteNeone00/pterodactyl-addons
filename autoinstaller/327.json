{
    "./app/Http/Controllers/Admin/Bagou/BagouCenterController.php": [
        {
            "type": "newfile",
            "theme": "any",
            "add": "<?php\n\nnamespace Pterodactyl\\Http\\Controllers\\Admin\\Bagou;\n\nuse Illuminate\\View\\View;\nuse Prologue\\Alerts\\AlertsMessageBag;\nuse Pterodactyl\\Http\\Controllers\\Controller;\nuse Illuminate\\Support\\Facades\\Http;\n\nclass BagouCenterController extends Controller\n{\n    protected $alert;\n\n    public function __construct(\n        AlertsMessageBag $alert\n    ) {\n        $this->alert = $alert;\n    }\n    /**\n     * Display licensing system\n     */\n    public function index(): View\n    {\n        $apistatus = Http::get('https://api.whee.lol/api/client/pterodactyl/checkOnline')->object();\n        $cdnstatus = Http::get('https://cdn.whee.lol/status')->object();\n\n        return view('admin.bagoucenter.index', ['apistatus' => $apistatus, 'cdnstatus' => $cdnstatus]);\n    }\n    public function settings(): View\n    {\n        return view('admin.bagoucenter.support.index');\n    }\n}\n"
        }
    ],
    "./app/Http/Controllers/Admin/Bagou/BagouLicenseController.php": [
        {
            "type": "newfile",
            "theme": "any",
            "add": "<?php\n\nnamespace Pterodactyl\\Http\\Controllers\\Admin\\Bagou;\n\nuse Illuminate\\View\\View;\nuse Pterodactyl\\Models\\Bagoulicense;\nuse Illuminate\\Http\\RedirectResponse;\nuse Prologue\\Alerts\\AlertsMessageBag;\nuse Pterodactyl\\Http\\Controllers\\Controller;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\Http;\n\nclass BagouLicenseController extends Controller\n{\n    protected $alert;\n\n    public function __construct(\n        AlertsMessageBag $alert\n    ) {\n        $this->alert = $alert;\n    }\n    /**\n     * Display licensing system\n     */\n    public function index(): View\n    {\n        $addonslist = Http::get('https://api.whee.lol/api/client/pterodactyl/addonsList')->json();\n        $licenses = Bagoulicense::all();\n        return view('admin.bagoucenter.license.index', ['addonslist' => $addonslist, 'licenses' => $licenses]);\n    }\n\n    /**\n     * Display license of the addon\n     *\n     * @throws \\Pterodactyl\\Exceptions\\Repository\\RecordNotFoundException\n     */\n    public function license(string $addon): View\n    {\n        $dbaddon = Bagoulicense::where('addon', $addon)->first();\n        $addonslist = Http::get('https://api.whee.lol/api/client/pterodactyl/addonsList')->json();\n        $licenses = Bagoulicense::all();\n        return view('admin.bagoucenter.license.license', [\n            'addon' => $addon,\n            'enabled' => ($dbaddon)? $dbaddon['enabled'] : 0,\n            'usage' => ($dbaddon) ? $dbaddon['usage'] : null ,\n            'maxusage' => ($dbaddon) ? $dbaddon['maxusage'] : null,\n            'license' => ($dbaddon) ? $dbaddon['license']: 'Your license',\n            'addonslist' => $addonslist,\n            'licenses' => $licenses\n        ]);\n    }\n\n    /**\n     * Set a license\n     *\n     * @throws \\Throwable\n     */\n    public function setlicense(Request $request, $addon): RedirectResponse\n    {   \n        $license = Http::accept('application/json')->post(\"https://api.whee.lol/api/client/pterodactyl/license\", [\n            'id' => $request->license,\n            'selectaddon' => $addon\n        ])->object();\n        if($license->message == 'Transaction is not valid.') {\n            $this->alert->danger('License not found please contact me on discord')->flash();\n            return redirect()->route('admin.bagoucenter.license.addon', $addon);\n        } else if($license->message == 'Too many license usage please contact me on discord') {\n            $this->alert->danger('License are already used on too many panel please contact me on discord')->flash();\n            return redirect()->route('admin.bagoucenter.license.addon', $addon);\n        } else if ($license->message == 'User blacklisted') {\n            if(Bagoulicense::where('addon', $addon)->exists()) {\n\n                Bagoulicense::where('addon', $addon)->update(['license' => $request->license, 'usage' => 1, 'maxusage' => 1, 'enabled' => false]);\n               } else {\n                Bagoulicense::create(['addon' => $addon, 'license' => $request->license, 'usage' => 1, 'maxusage' => 1, 'enabled' => false]);\n               }\n            $this->alert->danger('You are BLACKLISTED (probably because of a paypal dispute)')->flash();\n            return redirect()->route('admin.bagoucenter.license.addon', $addon);\n         } else if($license->message == 'Not the good addon') {\n            $this->alert->danger('This license is not for this addon!')->flash();\n            return redirect()->route('admin.bagoucenter.license.addon', $addon);\n        } else if($license->message == 'done' && $license->name == $addon && !$license->blacklisted) {\n            if(Bagoulicense::where('addon', $addon)->exists()) {\n\n                Bagoulicense::where('addon', $addon)->update(['license' => $request->license, 'usage' => $license->usage, 'maxusage' => $license->maxusage, 'enabled' => true]);\n               } else {\n                Bagoulicense::create(['addon' => $addon, 'license' => $request->license, 'usage' => $license->usage, 'maxusage' => $license->maxusage, 'enabled' => true]);\n               }\n        \n               $this->alert->success('License updated sucessfully!')->flash();\n               return redirect()->route('admin.bagoucenter.license.addon', $addon);\n        }\n        $this->alert->danger('Error!')->flash();\n        return redirect()->route('admin.bagoucenter.license.addon', $addon);\n    }\n\n    /**\n     * Remove a license\n     *\n     * @throws \\Throwable\n     */\n    public function removelicense($addon): RedirectResponse\n    {   \n            if(Bagoulicense::where('addon', $addon)->exists()) {\n                $transaction = Bagoulicense::where('addon', $addon)->first();\n                if(!$transaction) {\n                    $this->alert->danger('No license found.')->flash();\n                    return redirect()->route('admin.bagoucenter.license.addon', $addon);\n                }\n                $transaction = $transaction['license'];\n                $license = Http::delete(\"https://api.whee.lol/api/client/pterodactyl/license?id=$transaction\")->object();\n                Bagoulicense::where('addon', $addon)->delete();\n                $this->alert->success('License removed sucessfully')->flash();\n                return redirect()->route('admin.bagoucenter.license.addon', $addon);        \n               } else {\n                $this->alert->danger('No license found.')->flash();\n                return redirect()->route('admin.bagoucenter.license.addon', $addon);     \n            }\n    }\n}\n"
        }
    ],
    "./app/Http/Controllers/Admin/Bagou/BagouMcVersionsController.php": [
        {
            "type": "newfile",
            "theme": "any",
            "add": "<?php\n\nnamespace Pterodactyl\\Http\\Controllers\\Admin\\Bagou;\n\nuse Illuminate\\Support\\Facades\\Http;\nuse Illuminate\\View\\View;\nuse Prologue\\Alerts\\AlertsMessageBag;\nuse Pterodactyl\\Http\\Controllers\\Controller;\nuse Illuminate\\Http\\Request;\nuse Pterodactyl\\Models\\Bagoulicense;\nuse Pterodactyl\\Models\\MinecraftModpacks;\n\nclass BagouMcVersionsController extends Controller\n{\n    protected $alert;\n\n    public function __construct(\n        AlertsMessageBag $alert\n    ) {\n        $this->alert = $alert;\n    }\n    /**\n     * Display version \n     */\n    public function index(): View\n    {\n        $addonslist = Http::get('https://api.whee.lol/api/client/pterodactyl/addonsList')->json();\n        $licenses = Bagoulicense::all();\n        $modpacks = MinecraftModpacks::get();\n        return view('admin.bagoucenter.settings.mcversions.index', ['licenses' => $licenses, 'addonslist' => $addonslist, 'modpacks' => $modpacks]);\n    }\n    /**\n     * Add Versions\n     */\n    public function add(Request $request): View\n    {\n        if(!ends_with($request->url, ['zip', 'tar.gz', 'tar.xz'])) {\n            $this->alert->danger('The url is invalid (is not a direct link to a zip,tar.gz or tar.xz!')->flash();\n            return $this->index();\n        }\n        MinecraftModpacks::create(['name' => $request->name, 'version' => $request->version, 'mcversion' => $request->mcversion, 'url' => $request->url , 'icon' => $request->icon]);\n        $this->alert->success('Modpack added sucessfully!')->flash();\n        return $this->index();\n    }\n    /**\n     * Delete Versions\n     */\n    public function delete(string $id): View\n    {\n        MinecraftModpacks::where('id', '=', $id)->delete();\n        $this->alert->success('Modpack removed sucessfully!')->flash();\n        return $this->index();\n    }\n}\n"
        }
    ],
    "./app/Http/Controllers/Admin/Bagou/BagouSettingsController.php": [
        {
            "type": "newfile",
            "theme": "any",
            "add": "<?php\n\nnamespace Pterodactyl\\Http\\Controllers\\Admin\\Bagou;\n\nuse Illuminate\\View\\View;\nuse Pterodactyl\\Models\\Bagoulicense;\nuse Prologue\\Alerts\\AlertsMessageBag;\nuse Pterodactyl\\Http\\Controllers\\Controller;\nuse Illuminate\\Support\\Facades\\Http;\n\nclass BagouSettingsController extends Controller\n{\n    protected $alert;\n\n    public function __construct(\n        AlertsMessageBag $alert\n    ) {\n        $this->alert = $alert;\n    }\n    /**\n     * Display licensing system\n     */\n    public function index(): View\n    {\n        $addonslist = Http::get('https://api.whee.lol/api/client/pterodactyl/addonsList')->json();\n        $licenses = Bagoulicense::all();\n        return view('admin.bagoucenter.settings.index', ['addonslist' => $addonslist, 'licenses' => $licenses]);\n    }\n\n    /**\n     * Display licensing system\n     */\n    public function settings(string $addon): View\n    {\n        $addonslist = Http::get('https://api.whee.lol/api/client/pterodactyl/addonsList')->json();\n        $licenses = Bagoulicense::all();\n        return view('admin.bagoucenter.settings.index', ['addonslist' => $addonslist, 'licenses' => $licenses]);\n    }\n}\n"
        }
    ],
    "./app/Http/Controllers/Admin/Bagou/BagouSupportController.php": [
        {
            "type": "newfile",
            "theme": "any",
            "add": "<?php\n\nnamespace Pterodactyl\\Http\\Controllers\\Admin\\Bagou;\n\nuse Illuminate\\View\\View;\nuse Pterodactyl\\Http\\Controllers\\Controller;\n\nclass BagouSupportController extends Controller\n{\n    public function index(): View\n    {\n        return view('admin.bagoucenter.support.index');\n    }\n}\n"
        }
    ],
    "./app/Http/Controllers/Admin/Bagou/BagouVersionsController.php": [
        {
            "type": "newfile",
            "theme": "any",
            "add": "<?php\n\nnamespace Pterodactyl\\Http\\Controllers\\Admin\\Bagou;\n\nuse Illuminate\\View\\View;\nuse Pterodactyl\\Models\\Bagoulicense;\nuse Prologue\\Alerts\\AlertsMessageBag;\nuse Pterodactyl\\Http\\Controllers\\Controller;\nuse Illuminate\\Support\\Facades\\Http;\n\nclass BagouVersionsController extends Controller\n{\n    protected $alert;\n\n    public function __construct(\n        AlertsMessageBag $alert\n    ) {\n        $this->alert = $alert;\n    }\n    /**\n     * Display licensing system\n     */\n    public function index(): View\n    {\n        $addonslist = Http::get('https://api.whee.lol/api/client/pterodactyl/addonsList')->json();\n        $licenses = Bagoulicense::all();\n        return view('admin.bagoucenter.versions.index', ['addonslist' => $addonslist, 'licenses' => $licenses]);\n    }\n    /**\n     * Refresh Versions\n     */\n    public function refresh(): View\n    {\n        $licenses = Bagoulicense::all();\n        foreach($licenses as $license) {\n            $id = $license['license'];\n            $version = Http::get(\"https://api.whee.lol/api/client/pterodactyl/getVersion?id=$id\");\n            if($version->failed()) {\n                $addonslist = Http::get('https://api.whee.lol/api/client/pterodactyl/addonsList')->json();\n                $this->alert->danger('Error!')->flash();\n                return view('admin.bagoucenter.versions.index', ['addonslist' => $addonslist, 'licenses' => $licenses]);\n            } else {\n                Bagoulicense::where('license', '=', $id)->update(['version' => $version->json()['version']]);\n            }\n        }\n        $addonslist = Http::get('https://api.whee.lol/api/client/pterodactyl/addonsList')->json();\n        $licenses = Bagoulicense::all();\n        $this->alert->success('Versions updated sucessfully!')->flash();\n        return view('admin.bagoucenter.versions.index', ['addonslist' => $addonslist, 'licenses' => $licenses]);\n    }\n}\n"
        }
    ],
    "./routes/admin.php": [
        {
            "type": "under",
            "theme": "any",
            "where": "Route::delete('/database/{database}', [Admin\\DatabaseController::class, 'delete']);",
            "add": "\n/*\n|--------------------------------------------------------------------------\n| Bagou License Controller Routes\n|--------------------------------------------------------------------------\n|\n| Endpoint: /admin/bagoucenter\n|\n*/\nRoute::group(['prefix' => 'bagoucenter'], function () {\n    Route::get('/', [Admin\\Bagou\\BagouCenterController::class, 'index'])->name('admin.bagoucenter');\n    Route::get('/license/', [Admin\\Bagou\\BagouLicenseController::class, 'index'])->name('admin.bagoucenter.license');\n    Route::get('/license/{addon}', [Admin\\Bagou\\BagouLicenseController::class, 'license'])->name('admin.bagoucenter.license.addon');\n    Route::get('/versions/', [Admin\\Bagou\\BagouVersionsController::class, 'index'])->name('admin.bagoucenter.versions');\n    Route::get('/settings', [Admin\\Bagou\\BagouSettingsController::class, 'index'])->name('admin.bagoucenter.settings');\n    Route::get('/support/', [Admin\\Bagou\\BagouCenterController::class, 'settings'])->name('admin.bagoucenter.support');\n    Route::post('/license/{addon}', [Admin\\Bagou\\BagouLicenseController::class, 'setlicense']);\n    Route::post('/versions', [Admin\\Bagou\\BagouVersionsController::class, 'refresh']);\n    Route::delete('/license/{addon}', [Admin\\Bagou\\BagouLicenseController::class, 'removelicense']);\n});"
        }
    ],
    "./routes/api-client.php": [
        {
            "type": "above",
            "theme": "any",
            "where": "Route::group(['prefix' => '/settings'], function () {",
            "add": "    Route::group(['prefix' => '/mcmodpacks'], function () {\n        Route::get('/', [Client\\Servers\\Bagou\\Minecraft\\ModPacksController::class, 'getModPacks']);\n        Route::get('/mcversions', [Client\\Servers\\Bagou\\Minecraft\\ModPacksController::class, 'getMcVersions']);\n        Route::get('/description', [Client\\Servers\\Bagou\\Minecraft\\ModPacksController::class, 'getModpacksDescription']);\n        Route::get('/getversionsize', [Client\\Servers\\Bagou\\Minecraft\\ModPacksController::class, 'getversionsize']);\n        Route::post('/install', [Client\\Servers\\Bagou\\Minecraft\\ModPacksController::class, 'install']);\n    });\n"
        }
    ],
    "./app/Transformers/Api/Client/ServerTransformer.php": [
        {
            "type": "under",
            "theme": "any",
            "where": "'is_transferring' => !is_null($server->transfer),",
            "add": "            'mcversion' => $server->mcversion,\n            'nest_id' => $server->nest_id,\n            'egg_id' => $server->egg_id,"
        }
    ],
    "./resources/views/layouts/admin.blade.php": [
        {
            "type": "above",
            "theme": "any",
            "where": "<li class=\"header\">MANAGEMENT</li>",
            "add": "                        <li class=\"{{ ! starts_with(Route::currentRouteName(), 'admin.bagoucenter') ?: 'active' }}\">\n                            <a href=\"{{ route('admin.bagoucenter')}}\">\n                                <i class=\"fa fa-globe\"></i> <span>Bagou Center</span>\n                            </a>\n                        </li>"
        }
    ],
    "./resources/lang/en/activity.php": [
        {
            "type": "above",
            "theme": "any",
            "where": "    'startup' => [",
            "add": "    'versions' => [\n        'install' => 'Installation of :name',\n    ],"
        }
    ],
    "./database/migrations/2026_02_01_000000_addon_327_install.php": [
        {
            "type": "newfile",
            "theme": "any",
            "add": "<?php\n\nuse Illuminate\\Database\\Migrations\\Migration;\n\nclass Addon327Install extends Migration\n{\n    public function up()\n    {\n        // Addon 327 installation complete\n        // All files have been copied\n    }\n\n    public function down()\n    {\n        // Addon 327 removal\n    }\n}\n"
        }
    ],
    "./resources/scripts/routers/routes.ts": [
        {
            "type": "under",
            "theme": "pterodactyl",
            "where": "import McModpacksContainer from '@/components/server/mcmodpacks/McModpacksContainer';",
            "add": ""
        },
        {
            "type": "under",
            "theme": "pterodactyl",
            "where": "    {\n        path: '/files',\n        permission: 'file.*',\n        name: 'Files',\n        component: FileManagerContainer,\n    },",
            "add": "    {\n        path: '/minecraft/modpacks',\n        permission: 'file.*',\n        name: 'Modpacks',\n        nestId: 1,\n        component: McModpacksContainer,\n    },"
        }
    ],
    "./app/Models/Bagoulicense.php": [
        {
            "type": "newfile",
            "theme": "any",
            "add": "<?php\n\nnamespace Pterodactyl\\Models;\n\n/**\n * @property int $id\n * @property string $addon\n * @property string $license\n * @property int $usage\n * @property int $maxusage\n * @property bool $enabled\n * @property \\Carbon\\Carbon $created_at\n * @property \\Carbon\\Carbon $updated_at\n */\nclass BagouLicense extends Model\n{\n    /**\n     * The resource name for this model when it is transformed into an\n     * API representation using fractal.\n     */\n    public const RESOURCE_NAME = 'BagouLicense';\n\n    /**\n     * The table associated with the model.\n     *\n     * @var string\n     */\n    protected $table = 'bagoulicense';\n\n    /**\n     * Fields that are not mass assignable.\n     *\n     * @var array\n     */\n    protected $fillable = [\n        'addon',\n        'license',\n        'usage',\n        'maxusage',\n        'enabled'\n    ];\n\n    /**\n     * Cast values to correct type.\n     *\n     * @var array\n     */\n    protected $casts = [\n        'addon' => 'string',\n        'license' => 'string',\n        'usage' => 'integer',\n        'maxusage' => 'integer',\n        'enabled' => 'boolean'\n    ];\n\n    /**\n     * @var array\n     */\n    protected $validationRules = [\n        'addon' => 'required|string',\n        'license' => 'required|string',\n    ];\n}\n"
        }
    ]
}